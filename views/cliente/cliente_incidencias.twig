{% extends 'layout.twig' %}

{% block title 'incidencias del cliente' %}

{% block contenido %}
    <div class="contenido">
        <form class="" action="" method="post">
            <div class="vistaFormulario">
                {% if tipo == '1' %}
                    <p class="alert alert-primary">Incidencias del cliente: {{ dniCliente }}</p>
                {% elseif tipo == '0' %}
                    <p class="alert alert-primary">Todas las incidencias</p>
                {% endif %}
            </div>

            {% if tipo == '1' %}
                <div class="vistaFormulario">
                    <input class="btn btn-primary" type="submit" name="btnAdd" value="Nueva incidencia">
                    <input class="btn btn-primary" type="submit" name="btnVolver" value="Volver">
                </div>
            {% endif %}

            {% if mensaje == 'Si' %}
                <div class="contenedorTabla">
                    <table id="miTablaControlador" class="table table-bordered table-sm miTabla table-responsive-xl">
                        <thead class="miThead">
                        <tr>
                            {#Vista para el administrador#}
                            {% if rol == '0' %}
                            <th>Id</th>
                            <th>Creada</th>
                            <th>Técnico</th>
                            <th>Creacion</th>
                            <th>Resolución</th>
                            <th>Disponible</th>
                            <th>Tipo</th>
                            {% endif %}
                            {#Vista para el controlador#}
                            {% if rol == '4' %}
                                <th>Cliente_Dni</th>
                                <th>Cliente_Nombre</th>
                                <th>Cliente_Telefono</th>
                                <th>Info</th>
                            {% endif %}
                            <th>Acciones</th>

                        </tr>
                        </thead>

                        {#le pasamos la variable que contiene el array con las filas de la consulta#}
                        {% for fila in arrayFilas %}
                            <tr
                                {% if fila.estado == '3' %}
                                    class="terminada"
                                {% elseif fila.estado == '2' %}
                                    class="asignada"
                                {% elseif fila.estado == '1' %}
                                    class="activa"
                                {% elseif fila.estado == '0' %}
                                    class="no-asignada"
                                {% elseif fila.estado == '4' %}
                                    class="parcial"
                                {% endif %}
                            >
                                {% if rol == '0' %}
                                <td>{{ fila.id_incidencia }}</td>
                                <td>{{ fila.tnombre }}</td>
                                <td>{{ fila.ntecnico }}</td>
                                <td>{{ fila.fecha_creacion }}</td>
                                <td>{{ fila.fecha_resolucion }}</td>
                                <td>{{ fila.proxima_llamada }}</td>
                                <td>
                                    {% if fila.tipo == 'averia' %}
                                        Averia
                                    {% elseif fila.tipo == 'cambiodomicilio' %}
                                        Cambio de domicilio
                                    {% elseif fila.tipo == 'baja' %}
                                        Baja
                                    {% elseif fila.tipo == 'instalacion' %}
                                        Instalación
                                    {% endif %}
                                </td>
                                {% endif %}
                                {% if rol == '4' %}
                                    <td>{{ fila.id_cliente }}</td>
                                    <td>{{ fila.nombreCliente }}</td>
                                    <td>{{ fila.telefono }}</td>
                                    <td>{{ fila.otros }}</td>
                                {% endif %}
                                <td class="td-acciones">
                                    {% if rol == '0' or rol == '4' %}
                                        {% if fila.estado == '0' %}
                                            <a href="../controlador/controlador_confirmar_tecnicos.php?Id={{ fila.id_incidencia }}"><input type="button" class="botonAccion btnTecnico" title="Enviar a tecnicos"></a>
                                        {% endif %}
                                        {% if rol == '0' %}
                                            <a href="../cliente/cliente_incidencias_info.php?Id={{ fila.id_incidencia }}&tipo=0&o=0"><input type="button" class="botonAccion btnInfo" title="Más información"></a>
                                        {% else %}
                                            <a href="../cliente/cliente_incidencias_info.php?Id={{ fila.id_incidencia }}&o=0"><input type="button" class="botonAccion btnInfo" title="Más información"></a>
                                        {% endif %}
                                    {% endif %}
                                </td>


                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% elseif mensaje == 'No' %}
                <div class="vistaFomulario">
                    {% if rol == '0' %}
                        <p class="alert alert-primary">El cliente: {{ dniCliente }}, no tiene incidencias en este momento</p>
                    {% elseif rol == '4' %}
                        <p class="alert alert-primary">En este momento no hay incidencias para mostrar</p>
                    {% endif %}
                </div>
            {% endif %}
        </form>

    </div>
{% endblock %}

{% block usuario %}
 <span>Conectado como: {{ usuario }}</span>
{% endblock %}