{% extends 'layout.twig' %}

{% block title 'incidencias del cliente' %}

{% block contenido %}
    <div class="contenido">
        <form class="" action="" method="post">
            <div class="vistaFormulario">
                {% if tipo == '1' %}
                    <p class="alert alert-primary">Incidencias del cliente: {{ dniCliente }}</p>
                {% elseif tipo == '0' %}
                    <p class="alert alert-primary">Todas las incidencias</p>
                {% endif %}
            </div>

            {% if tipo == '1' %}
                <div class="vistaFormulario">
                    <input class="btn btn-primary" type="submit" name="btnAdd" value="Nueva incidencia">
                    <input class="btn btn-primary" type="submit" name="btnVolver" value="Volver">
                </div>
            {% endif %}

            {% if mensaje == 'Si' %}
                <div class="contenedorTabla">
                    <table id="miTablaControlador" class="table table-bordered table-sm miTabla table-responsive-xl">
                        <thead class="miThead">
                        <tr>
                            {#Vista para el administrador#}
                            {% if rol == '0' %}
                            <th>Id</th>
                            <th>Creada</th>
                            {#<th>técnico</th>#}
                            <th>Creacion</th>
                            <th>Resolución</th>
                            <th>Disponible</th>
                            <th>Tipo</th>
                            {#<th>Estado</th>#}
                            {#<th>Reincidencia</th>#}
                            {#<th>Otros</th>#}
                            {% endif %}
                            {#Vista para el controlador#}
                            {% if rol == '4' %}
                                {#<th>Id</th>#}
                                {#<th>Comercial</th>#}
                                <th>Cliente_Dni</th>
                                <th>Cliente_Nombre</th>
                                <th>Cliente_Telefono</th>
                                {#<th>Cliente_Direccion</th>#}
                                {#<th>Cliente_Ciudad</th>#}
                                {#<th>Creacion</th>#}
                                <th>Info</th>
                            {% endif %}


                        </tr>
                        </thead>

                        {#le pasamos la variable que contiene el array con las filas de la consulta#}
                        {% for fila in arrayFilas %}
                            <tr>
                                {% if rol == '0' %}
                                <td>{{ fila.id_incidencia }}</td>
                                <td>{{ fila.usuario }}</td>
                                {#<td>{{ fila.tecnico }}</td>#}
                                <td>{{ fila.fecha_creacion }}</td>
                                <td>{{ fila.fecha_resolucion }}</td>
                                <td>{{ fila.proxima_llamada }}</td>
                                <td>
                                    {% if fila.tipo == 'averia' %}
                                        Averia
                                    {% elseif fila.tipo == 'cambiodomicilio' %}
                                        Cambio de domicilio
                                    {% elseif fila.tipo == 'baja' %}
                                        Baja
                                    {% elseif fila.tipo == 'instalacion' %}
                                        Instalación
                                    {% endif %}
                                </td>
                                {% endif %}
                                {% if rol == '4' %}
                                    {#<td>{{ fila.id_incidencia }}</td>#}
                                    {#<td><a href="#"></a>{{ fila.usuarioUsuario }}</td>#}
                                    <td>{{ fila.id_cliente }}</td>
                                    <td>{{ fila.nombreCliente }}</td>
                                    <td>{{ fila.telefono }}</td>
                                    {#<td>{{ fila.direccion }}</td>#}
                                    {#<td>{{ fila.ciudad }}</td>#}
                                    {#<td>{{ fila.fecha_creacion }}</td>#}
                                    <td>{{ fila.otros }}</td>
                                {% endif %}


                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% elseif mensaje == 'No' %}
                <div class="vistaFomulario">
                    {% if rol == '0' %}
                        <p class="alert alert-primary">El cliente: {{ dniCliente }}, no tiene incidencias en este momento</p>
                    {% elseif rol == '4' %}
                        <p class="alert alert-primary">En este momento no hay incidencias para mostrar</p>
                    {% endif %}
                </div>
            {% endif %}
        </form>

    </div>
{% endblock %}

{% block usuario %}
 <span>Conectado como: {{ usuario }}</span>
{% endblock %}